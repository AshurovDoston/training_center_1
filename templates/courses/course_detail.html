{% extends 'base.html' %}
{% load static %}

{% block title %}{{ course.title }} - Gamzan{% endblock %}

{% block content %}
<article class="course-detail">
    <a href="{% url 'course_list' %}" class="back-link">All Courses</a>

    <header class="hero--detail">
        <h1 class="hero-detail-title">{{ course.title }}</h1>
        <p class="hero-detail-instructor">
            Taught by <strong>{{ course.instructor }}</strong>
        </p>
        <div class="course-detail-stats">
            <span class="stat-item stat-item--hero"><strong>{{ modules_count }}</strong> Module{{ modules_count|pluralize }}</span>
            <span class="stat-item stat-item--hero"><strong>{{ lessons_count }}</strong> Lesson{{ lessons_count|pluralize }}</span>
        </div>
    </header>

    <section class="section">
        <h2 class="section-title">About this Course</h2>
        <div class="section-content">
            <p>{{ course.description }}</p>
        </div>
    </section>

    <section class="section">
        <h2 class="section-title">Course Curriculum</h2>

        {% if course.modules.all %}
        <ul class="module-list">
            {% for module in course.modules.all %}
            <li class="module-item">
                <button
                    class="accordion-header"
                    data-target="module-{{ forloop.counter }}"
                    aria-expanded="false"
                >
                    <span class="accordion-title">{{ module.title }}</span>
                    <span class="accordion-meta">{{ module.lessons_count }} lesson{{ module.lessons_count|pluralize }}</span>
                    <span class="accordion-icon">+</span>
                </button>

                <div class="accordion-panel" id="module-{{ forloop.counter }}">
                    {% if module.lessons.all %}
                    <ul class="lesson-list">
                        {% for lesson in module.lessons.all %}
                        <li class="lesson-item">
                            <a href="{% url 'lesson_detail' course.slug lesson.pk %}">{{ lesson.title }}</a>
                        </li>
                        {% endfor %}
                    </ul>
                    {% else %}
                    <p class="no-lessons">No lessons in this module yet.</p>
                    {% endif %}
                </div>
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <p class="no-modules">Course curriculum coming soon.</p>
        {% endif %}
    </section>

    <section class="section">
        <h2 class="section-title">About the Instructor</h2>
        <div class="instructor-card">
            <div class="instructor-card-avatar">
                {{ course.instructor|make_list|first }}
            </div>
            <div class="instructor-card-body">
                <h3 class="instructor-card-name">{{ course.instructor }}</h3>
                <p class="instructor-card-bio">{{ course.instructor.bio|default:"No bio available." }}</p>
            </div>
        </div>
    </section>

    <section class="course-enrollment">
        {% if user.is_authenticated %}
            {% if is_enrolled %}
            <p class="enrollment-status enrollment-status--enrolled">You are enrolled in this course.</p>
            {% if first_lesson %}
            <a href="{% url 'lesson_detail' course.slug first_lesson.pk %}" class="btn btn-primary">Continue Learning</a>
            {% endif %}
            {% else %}
            <h2 class="enrollment-title">Ready to start learning?</h2>
            <p class="enrollment-text">Enroll now and begin your journey through this course.</p>
            <form method="post" action="{% url 'enroll_in_course' course.slug %}" class="enrollment-form">
                {% csrf_token %}
                <button type="submit" class="btn btn-primary btn--lg">Enroll Now</button>
            </form>
            {% endif %}
        {% else %}
        <h2 class="enrollment-title">Want to enroll?</h2>
        <p class="enrollment-prompt">
            <a href="{% url 'login' %}" class="btn btn-primary">Log in</a>
            <span class="enrollment-or">or</span>
            <a href="{% url 'signup' %}" class="btn btn-secondary">Sign up</a>
        </p>
        {% endif %}
    </section>

    <footer class="course-meta">
        <p class="course-created">Last updated {{ course.updated_at|date:"F j, Y" }}</p>
    </footer>
</article>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/accordion.js' %}"></script>
{% endblock %}
