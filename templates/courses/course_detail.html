{% extends 'base.html' %}
{% load static %}

{% block title %}{{ course.title }} - Gamzan{% endblock %}

{% block content %}
<article class="course-detail">
    <a href="{% url 'course_list' %}" class="back-link">All Courses</a>

    <header class="course-header">
        <h1 class="course-title">{{ course.title }}</h1>
        <div class="course-instructor">
            <span class="instructor-label">Instructor:</span>
            <span class="instructor-name">{{ course.instructor }}</span>
        </div>
    </header>

    <section class="section">
        <h2 class="section-title">About this Course</h2>
        <div class="section-content">
            <p>{{ course.description }}</p>
        </div>
    </section>

    <section class="section">
        <h2 class="section-title">About the Instructor</h2>
        <div class="section-content">
            <p>{{ course.instructor.bio }}</p>
        </div>
    </section>

    <section class="course-enrollment">
        <h2 class="section-title">Enroll in this Course</h2>
        {% if user.is_authenticated %}
            {% if is_enrolled %}
            <p class="enrollment-status">You are already enrolled in this course.</p>
            <a href="#" class="btn btn-primary">Continue Learning</a>
            {% else %}
            <form method="post" action="#" class="enrollment-form">
                {% csrf_token %}
                <button type="submit" class="btn btn-primary">Enroll Now</button>
            </form>
            {% endif %}
        {% else %}
        <p class="enrollment-prompt">Please <a href="{% url 'login' %}">log in</a> to enroll.</p>
        {% endif %}
    </section>

    <section class="section">
        <h2 class="section-title">Course Curriculum</h2>

        {% if course.modules.all %}
        <ul class="module-list">
            {% for module in course.modules.all %}
            <li class="module-item">
                <button
                    class="accordion-header"
                    data-target="module-{{ forloop.counter }}"
                    aria-expanded="false"
                >
                    <span class="accordion-title">{{ module.title }}</span>
                    <span class="accordion-icon">+</span>
                </button>

                <div class="accordion-panel" id="module-{{ forloop.counter }}">
                    {% if module.lessons.all %}
                    <ul class="lesson-list">
                        {% for lesson in module.lessons.all %}
                        <li class="lesson-item">
                            <a href="{% url 'lesson_detail' course.slug lesson.pk %}">{{ lesson.title }}</a>
                        </li>
                        {% endfor %}
                    </ul>
                    {% else %}
                    <p class="no-lessons">No lessons in this module yet.</p>
                    {% endif %}
                </div>
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <p class="no-modules">Course curriculum coming soon.</p>
        {% endif %}
    </section>

    <footer class="course-meta">
        <p class="course-created">Updated: {{ course.updated_at|date:"F j, Y" }}</p>
    </footer>
</article>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/accordion.js' %}"></script>
{% endblock %}
